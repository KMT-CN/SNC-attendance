# Docker éƒ¨ç½²é‡ç½®æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•åœ¨ Docker éƒ¨ç½²ä¸­é‡ç½®ç³»ç»Ÿã€‚

## ğŸ”„ é‡ç½®é€‰é¡¹

### é€‰é¡¹1ï¼šä»…é‡ç½®æ•°æ®ï¼ˆæ¨èç”¨äºæµ‹è¯•ï¼‰

**ä¿ç•™**ï¼šé…ç½®æ–‡ä»¶ï¼ˆ.envï¼‰ã€Dockeré•œåƒ  
**åˆ é™¤**ï¼šæ‰€æœ‰æ•°æ®åº“æ•°æ®

é€‚ç”¨åœºæ™¯ï¼š
- æµ‹è¯•é¦–æ¬¡æ³¨å†ŒåŠŸèƒ½
- æ¸…ç©ºç”¨æˆ·æ•°æ®é‡æ–°å¼€å§‹
- ä¿ç•™é…ç½®ä½†é‡ç½®æ•°æ®

#### Windows (PowerShell)
```powershell
.\reset-data.ps1
```

#### Linux/Mac
```bash
chmod +x reset-data.sh
./reset-data.sh
```

### é€‰é¡¹2ï¼šå®Œå…¨é‡ç½®ï¼ˆé‡æ–°å¼€å§‹ï¼‰

**åˆ é™¤**ï¼šæ‰€æœ‰å®¹å™¨ã€å·ã€é•œåƒã€é…ç½®æ–‡ä»¶

é€‚ç”¨åœºæ™¯ï¼š
- å®Œå…¨é‡æ–°éƒ¨ç½²
- æ›´æ”¹é…ç½®éœ€è¦é‡å»º
- æ¸…ç†æ‰€æœ‰ Docker èµ„æº

#### Windows (PowerShell)
```powershell
.\reset.ps1
```

#### Linux/Mac
```bash
chmod +x reset.sh
./reset.sh
```

## ğŸ“ è¯¦ç»†è¯´æ˜

### ä»…é‡ç½®æ•°æ® (reset-data)

æ‰§è¡Œæ­¥éª¤ï¼š
1. åœæ­¢æ‰€æœ‰ Docker å®¹å™¨
2. åˆ é™¤å®¹å™¨å’Œæ•°æ®å·ï¼ˆ`docker compose down -v`ï¼‰
3. é‡æ–°å¯åŠ¨æœåŠ¡
4. æ•°æ®åº“ä¸ºç©ºï¼Œå¯ä»¥æ³¨å†Œç¬¬ä¸€ä¸ªè¶…çº§ç®¡ç†å‘˜

**ä¿ç•™å†…å®¹**ï¼š
- `.env` é…ç½®æ–‡ä»¶
- Docker é•œåƒï¼ˆæ— éœ€é‡æ–°æ„å»ºï¼‰
- ç½‘ç»œé…ç½®

**æ‰§è¡Œæ—¶é—´**ï¼šçº¦ 10-20 ç§’

### å®Œå…¨é‡ç½® (reset)

æ‰§è¡Œæ­¥éª¤ï¼š
1. åœæ­¢æ‰€æœ‰ Docker å®¹å™¨
2. åˆ é™¤å®¹å™¨ã€å·å’Œç½‘ç»œ
3. åˆ é™¤æ‰€æœ‰ç›¸å…³ Docker é•œåƒ
4. åˆ é™¤ `.env` é…ç½®æ–‡ä»¶
5. æ¸…ç† Docker ç³»ç»Ÿ

**åˆ é™¤å†…å®¹**ï¼š
- æ‰€æœ‰æ•°æ®
- æ‰€æœ‰é…ç½®
- æ‰€æœ‰ Docker èµ„æº

**æ‰§è¡Œæ—¶é—´**ï¼šçº¦ 30-60 ç§’

ä¹‹åéœ€è¦ï¼š
```powershell
# é‡æ–°éƒ¨ç½²
.\deploy.ps1
```

## âš ï¸ å®‰å…¨æç¤º

### ç¡®è®¤æç¤º

æ‰€æœ‰é‡ç½®è„šæœ¬éƒ½éœ€è¦è¾“å…¥ `YES` ç¡®è®¤ï¼š

```
Type 'YES' to continue with data reset: YES
```

- åªæœ‰å‡†ç¡®è¾“å…¥ `YES`ï¼ˆå¤§å†™ï¼‰æ‰ä¼šç»§ç»­
- å…¶ä»–ä»»ä½•è¾“å…¥éƒ½ä¼šå–æ¶ˆæ“ä½œ

### æ•°æ®å¤‡ä»½

**é‡è¦**ï¼šé‡ç½®å‰è¯·ç¡®ä¿ï¼š

1. **ç”Ÿäº§ç¯å¢ƒå¿…é¡»å¤‡ä»½**
   ```bash
   # å¤‡ä»½ MongoDB æ•°æ®
   docker compose exec mongodb mongodump --out=/dump/backup-$(date +%Y%m%d)
   
   # å¤åˆ¶å¤‡ä»½åˆ°æœ¬åœ°
   docker cp attendance-mongodb:/dump ./mongodb-backup
   ```

2. **ä¿å­˜é…ç½®æ–‡ä»¶**
   ```bash
   # å¤‡ä»½ .env
   cp Backend/.env Backend/.env.backup
   ```

3. **å¯¼å‡ºç”¨æˆ·åˆ—è¡¨**
   ```bash
   cd Backend
   node check-users.js > users-backup.txt
   ```

## ğŸ” éªŒè¯é‡ç½®æˆåŠŸ

### æ£€æŸ¥ Docker èµ„æº

```powershell
# æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨
docker compose ps

# æŸ¥çœ‹å·
docker volume ls

# æŸ¥çœ‹é•œåƒ
docker images
```

### æ£€æŸ¥æ•°æ®åº“çŠ¶æ€

```powershell
cd Backend
node check-users.js
```

åº”æ˜¾ç¤ºï¼š
```
ç”¨æˆ·æ€»æ•°: 0
éœ€è¦åˆå§‹åŒ–: æ˜¯ âœ…
```

### è®¿é—®ç³»ç»Ÿ

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®ç™»å½•é¡µé¢
2. åº”è¯¥çœ‹åˆ°æ³¨å†Œè¡¨å•
3. æ˜¾ç¤º"ğŸ‰ æ¬¢è¿é¦–æ¬¡ä½¿ç”¨ï¼"

## ğŸš€ é‡ç½®åçš„éƒ¨ç½²æµç¨‹

### ä»…é‡ç½®æ•°æ®å

æ•°æ®å·²æ¸…ç©ºï¼Œä½†ç³»ç»Ÿä»åœ¨è¿è¡Œï¼š

1. âœ… è®¿é—®ç™»å½•é¡µé¢
2. âœ… æ³¨å†Œç¬¬ä¸€ä¸ªè¶…çº§ç®¡ç†å‘˜
3. âœ… å¼€å§‹ä½¿ç”¨

### å®Œå…¨é‡ç½®å

éœ€è¦é‡æ–°éƒ¨ç½²ï¼š

```powershell
# 1. é‡æ–°éƒ¨ç½²
.\deploy.ps1

# 2. ç­‰å¾…æœåŠ¡å¯åŠ¨ï¼ˆçº¦30ç§’ï¼‰

# 3. è®¿é—®ç™»å½•é¡µé¢
# 4. æ³¨å†Œç¬¬ä¸€ä¸ªè¶…çº§ç®¡ç†å‘˜
```

## ğŸ“‹ å¸¸è§é—®é¢˜

### Q: é‡ç½®åæ— æ³•è®¿é—®ç³»ç»Ÿï¼Ÿ

A: ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨ï¼ˆ30-60ç§’ï¼‰ï¼Œç„¶åæ£€æŸ¥ï¼š
```powershell
# æŸ¥çœ‹æ—¥å¿—
cd Backend
docker compose logs -f
```

### Q: æƒ³ä¿ç•™æŸäº›æ•°æ®æ€ä¹ˆåŠï¼Ÿ

A: é‡ç½®å‰å…ˆå¤‡ä»½ï¼š
```powershell
# å¯¼å‡ºç”¨æˆ·æ•°æ®
node check-users.js > backup.txt

# æˆ–æ‰‹åŠ¨è®°å½•é‡è¦ä¿¡æ¯
```

### Q: é‡ç½®å .env æ–‡ä»¶æ¶ˆå¤±ï¼Ÿ

A: 
- `reset-data.ps1` ä¸ä¼šåˆ é™¤ .env
- `reset.ps1` ä¼šåˆ é™¤ .envï¼Œéœ€è¦é‡æ–°è¿è¡Œ `deploy.ps1`

### Q: Docker ç£ç›˜ç©ºé—´ä¸è¶³ï¼Ÿ

A: ä½¿ç”¨å®Œå…¨é‡ç½®æ¸…ç†æ‰€æœ‰èµ„æºï¼š
```powershell
.\reset.ps1

# æˆ–æ‰‹åŠ¨æ¸…ç†
docker system prune -a --volumes
```

### Q: å¦‚ä½•åªé‡ç½®ç”¨æˆ·æ•°æ®ä½†ä¿ç•™å…¶ä»–æ•°æ®ï¼Ÿ

A: ä½¿ç”¨ Node.js è„šæœ¬ï¼ˆä¸éœ€è¦é‡å¯ Dockerï¼‰ï¼š
```powershell
cd Backend
node clear-users.js
```

## ğŸ› ï¸ æ‰‹åŠ¨é‡ç½®å‘½ä»¤

å¦‚æœè„šæœ¬æ— æ³•ä½¿ç”¨ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼š

### ä»…é‡ç½®æ•°æ®
```powershell
cd Backend
docker compose down -v
docker compose up -d
```

### å®Œå…¨é‡ç½®
```powershell
cd Backend
docker compose down -v --remove-orphans
docker rmi $(docker images -q 'attendance-backend*')
Remove-Item .env
docker system prune -f
```

## ğŸ“Š é‡ç½®å¯¹æ¯”è¡¨

| æ“ä½œ | reset-data | reset | clear-users.js |
|------|-----------|-------|----------------|
| åœæ­¢æœåŠ¡ | âœ… | âœ… | âŒ |
| åˆ é™¤æ•°æ® | âœ… | âœ… | âœ… |
| åˆ é™¤é…ç½® | âŒ | âœ… | âŒ |
| åˆ é™¤é•œåƒ | âŒ | âœ… | âŒ |
| éœ€è¦é‡å¯ | âœ… è‡ªåŠ¨ | âŒ éœ€æ‰‹åŠ¨ | âŒ |
| æ‰§è¡Œæ—¶é—´ | ~15ç§’ | ~45ç§’ | ~2ç§’ |
| æ¨èåœºæ™¯ | æµ‹è¯•é¦–æ¬¡ä½¿ç”¨ | å®Œå…¨é‡æ–°å¼€å§‹ | å¿«é€Ÿæ¸…ç©ºç”¨æˆ· |

## ğŸ¯ æœ€ä½³å®è·µ

1. **å¼€å‘æµ‹è¯•**ï¼šä½¿ç”¨ `node clear-users.js`ï¼ˆæœ€å¿«ï¼‰
2. **Docker æµ‹è¯•**ï¼šä½¿ç”¨ `reset-data.ps1`ï¼ˆä¿ç•™é…ç½®ï¼‰
3. **å®Œå…¨é‡å»º**ï¼šä½¿ç”¨ `reset.ps1`ï¼ˆå½»åº•æ¸…ç†ï¼‰
4. **ç”Ÿäº§ç¯å¢ƒ**ï¼šè°¨æ…ä½¿ç”¨ï¼Œå¿…é¡»å…ˆå¤‡ä»½

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹æ—¥å¿—ï¼š`docker compose logs -f`
2. æ£€æŸ¥çŠ¶æ€ï¼š`docker compose ps`
3. æ‰‹åŠ¨æ¸…ç†ï¼šå‚è€ƒ"æ‰‹åŠ¨é‡ç½®å‘½ä»¤"éƒ¨åˆ†
